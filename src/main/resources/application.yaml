spring:
  application:
    name: resilience4j-patterns-playground

resilience4j:
  # ============================================
  # CIRCUIT BREAKER CONFIGURATION
  # ============================================
  circuitbreaker:
    instances:
      mainService:
        slidingWindowSize: 5                    # Number of calls to track
        failureRateThreshold: 50                # 50% failure rate opens circuit
        waitDurationInOpenState: 10s            # Wait 10s before trying again
        permittedNumberOfCallsInHalfOpenState: 3
        minimumNumberOfCalls: 3                 # Need 3 calls before calculating failure rate
        automaticTransitionFromOpenToHalfOpenEnabled: true

      circuitBreakerService:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 5s
        permittedNumberOfCallsInHalfOpenState: 2
        minimumNumberOfCalls: 5
        automaticTransitionFromOpenToHalfOpenEnabled: true
        recordExceptions:
          - java.lang.RuntimeException
        ignoreExceptions:
          - java.lang.IllegalArgumentException

  # ============================================
  # RETRY CONFIGURATION
  # ============================================
  retry:
    instances:
      mainService:
        maxAttempts: 3                          # Try up to 3 times
        waitDuration: 1s                        # Wait 1s between retries
        enableExponentialBackoff: false
        retryExceptions:
          - java.lang.RuntimeException

      retryService:
        maxAttempts: 3
        waitDuration: 500ms
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2         # 500ms, 1s, 2s
        retryExceptions:
          - java.lang.RuntimeException

  # ============================================
  # RATE LIMITER CONFIGURATION
  # ============================================
  ratelimiter:
    instances:
      mainService:
        limitForPeriod: 2                       # Allow 2 calls
        limitRefreshPeriod: 10s                 # Every 10 seconds
        timeoutDuration: 0                      # Don't wait, reject immediately

      rateLimiterService:
        limitForPeriod: 5                       # Allow 5 calls
        limitRefreshPeriod: 10s                 # Every 10 seconds
        timeoutDuration: 0ms                    # Immediate rejection

  # ============================================
  # BULKHEAD CONFIGURATION
  # ============================================
  bulkhead:
    instances:
      mainService:
        maxConcurrentCalls: 3                   # Max 3 concurrent calls
        maxWaitDuration: 0                      # Don't wait, reject immediately

      bulkheadService:
        maxConcurrentCalls: 2                   # Max 2 concurrent calls
        maxWaitDuration: 100ms                  # Wait up to 100ms for a slot

  # ============================================
  # TIME LIMITER CONFIGURATION
  # ============================================
  timelimiter:
    instances:
      mainService:
        timeoutDuration: 2s                     # Timeout after 2 seconds
        cancelRunningFuture: true

      timeLimiterService:
        timeoutDuration: 3s                     # Timeout after 3 seconds
        cancelRunningFuture: true

# ============================================
# LOGGING CONFIGURATION
# ============================================
logging:
  level:
    io.github.resilience4j: DEBUG
    dev.dead.resillience4jpatternsplayground: DEBUG

# ============================================
# ACTUATOR CONFIGURATION
# ============================================
management:
  endpoints:
    web:
      exposure:
        include: health,prometheus,metrics,circuitbreakers,circuitbreakerevents,ratelimiters,bulkheads
  endpoint:
    health:
      show-details: always
  health:
    circuitbreakers:
      enabled: true
    ratelimiters:
      enabled: true